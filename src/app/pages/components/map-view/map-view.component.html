<div class="map-view-container">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1><mat-icon>map</mat-icon> Mapa de Incidentes</h1>
    </div>

  <mat-card class="mb-4 mat-elevation-z4 filter-card">
    <mat-card-content>
      <form [formGroup]="filterForm" (ngSubmit)="applyFilters()">
        <div class="row align-items-end">
          <div class="col-md-5 mb-2">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Fecha Desde</mat-label>
              <input matInput [matDatepicker]="pickerDesde" formControlName="fechaInicioObj" required>
              <mat-datepicker-toggle matIconSuffix [for]="pickerDesde"></mat-datepicker-toggle>
              <mat-datepicker #pickerDesde></mat-datepicker>
              <mat-error *ngIf="filterForm.get('fechaInicioObj')?.hasError('required')">
                Fecha de inicio requerida
              </mat-error>
            </mat-form-field>
          </div>
          <div class="col-md-5 mb-2">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Fecha Hasta</mat-label>
              <input matInput [matDatepicker]="pickerHasta" formControlName="fechaFinObj" required>
              <mat-datepicker-toggle matIconSuffix [for]="pickerHasta"></mat-datepicker-toggle>
              <mat-datepicker #pickerHasta></mat-datepicker>
               <mat-error *ngIf="filterForm.get('fechaFinObj')?.hasError('required')">
                Fecha de fin requerida
              </mat-error>
            </mat-form-field>
          </div>
          <div class="col-md-2 mb-2">
            <button mat-raised-button color="primary" type="submit" class="w-100" [disabled]="isLoading">
                <span *ngIf="!isLoading">
                    <mat-icon>filter_list</mat-icon> Mostrar
                </span>
                 <span *ngIf="isLoading">
                    <mat-progress-spinner diameter="20" mode="indeterminate"></mat-progress-spinner>
                    Cargando...
                 </span>
            </button>
          </div>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <mat-card class="mat-elevation-z4 map-card">
    <mat-card-content class="p-0">
      <div id="map-full" class="leaflet-map leaflet-map-large">
         <div *ngIf="!map" class="map-placeholder">Inicializando mapa...</div>
      </div>
    </mat-card-content>
  </mat-card>
</div>

